machine:
  environment:
    LIBSASS_VERSION: $(cat $HOME/$CIRCLE_PROJECT_REPONAME/.libsass_version)
    PROJECT_ROOT: $HOME/.go_workspace/src/github.com/wellington/wellington
    PKG_CONFIG_PATH: "$HOME/$CIRCLE_PROJECT_REPONAME/libsass/lib/pkgconfig/"
dependencies:
  cache_directories:
    - "$CIRCLE_PROJECT_REPONAME/libsass"    # relative to the build directory
  pre:
    - go get -f -u -d github.com/wellington/spritewell
    - go get -f -u -d gopkg.in/fsnotify.v1
    - go get github.com/axw/gocov/gocov
    - go get github.com/mattn/goveralls
    - go get golang.org/x/tools/cmd/goimports
    - go get github.com/golang/lint/golint
    - echo $LIBSASS_VERSION
    - make deps
  override:
    - echo $PROJECT_ROOT/hello
checkout:
  post:
    - mkdir -p ${GOPATH%%:*}/src/github.com/${CIRCLE_PROJECT_USERNAME}
    - rm -rf ${GOPATH%%:*}/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}
    - cp -R $(pwd) ${GOPATH%%:*}/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}
test:
  override:
    - go list -f "{{range .TestImports}}{{.}} {{end}}" . | xargs -r go get
    - cd $PROJECT_ROOT && make test
    - cd $PROJECT_ROOT && GIT_BRANCH=$CIRCLE_BRANCH goveralls -coverprofile=profile.cov -service=circleci -repotoken $COVERALLS_TOKEN
    - goxc -tasks='xc archive' -bc 'linux' -arch 'amd64' -d $CIRCLE_ARTIFACTS -n wt -wd wt
